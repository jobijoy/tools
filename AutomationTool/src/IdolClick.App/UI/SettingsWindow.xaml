<Window x:Class="IdolClick.UI.SettingsWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="Settings - Idol Click" 
        Height="480" Width="480"
        MinHeight="400" MinWidth="380"
        Background="{StaticResource BackgroundBrush}"
        WindowStartupLocation="CenterOwner"
        ResizeMode="CanResizeWithGrip"
        Icon="/Assets/idol-click.png">

    <Grid Margin="20">
        <Grid.RowDefinitions>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <ScrollViewer Grid.Row="0" VerticalScrollBarVisibility="Auto">
        <StackPanel>
            <TextBlock Text="Settings" FontSize="18" FontWeight="SemiBold" Foreground="{StaticResource PrimaryBrush}" Margin="0,0,0,20"/>

            <Label Content="Toggle Hotkey" Foreground="{StaticResource TextSecondaryBrush}"/>
            <TextBox x:Name="HotkeyBox" Margin="0,0,0,15" ToolTip="Keyboard shortcut to toggle automation (e.g., Ctrl+Alt+T)"/>

            <Label Content="Log Level" Foreground="{StaticResource TextSecondaryBrush}"/>
            <ComboBox x:Name="LogLevelCombo" Margin="0,0,0,15">
                <ComboBoxItem Content="Debug"/>
                <ComboBoxItem Content="Info"/>
                <ComboBoxItem Content="Warning"/>
                <ComboBoxItem Content="Error"/>
            </ComboBox>

            <TextBlock Text="Behavior" FontSize="14" FontWeight="SemiBold" Foreground="{StaticResource TextBrush}" Margin="0,10,0,10"/>
            
            <CheckBox x:Name="ShowPanelOnStartCheck" Content="Show control panel on startup" Margin="0,0,0,10"/>
            <CheckBox x:Name="StartWithWindowsCheck" Content="Start Idol Click with Windows" Margin="0,0,0,10" ToolTip="Add to Windows startup"/>
            <CheckBox x:Name="MouseNudgeCheck" Content="Prevent sleep by nudging mouse" Margin="0,0,0,10"/>
            
            <TextBlock Text="Display" FontSize="14" FontWeight="SemiBold" Foreground="{StaticResource TextBrush}" Margin="0,10,0,10"/>
            
            <CheckBox x:Name="ShowExecutionCountCheck" Content="Show session execution count column" Margin="0,0,0,10" ToolTip="Display ðŸ” count for each rule (resets on restart)"/>
            <CheckBox x:Name="ClickRadarCheck" Content="Click Radar â€” show pulse animation at click point" Margin="0,0,0,10" ToolTip="Displays expanding concentric circles at each automated click so you can observe actions. Fully click-through, never steals focus."/>

            <Separator Margin="0,15"/>

            <TextBlock Text="Safety" FontSize="14" FontWeight="SemiBold" Foreground="{StaticResource PrimaryBrush}" Margin="0,10,0,6"/>
            <TextBlock Text="Safety guardrails protect against accidental damage and runaway automation." 
                       Foreground="{StaticResource TextSecondaryBrush}" FontSize="11" TextWrapping="Wrap" Margin="0,0,0,8"/>

            <Label Content="Kill Switch Hotkey" Foreground="{StaticResource TextSecondaryBrush}" Padding="0,0,0,2"/>
            <TextBox x:Name="KillSwitchHotkeyBox" Margin="0,0,0,10" 
                     ToolTip="Emergency stop hotkey â€” instantly disables all automation (e.g., Ctrl+Alt+Escape)"/>

            <Label Content="Allowed Processes (comma-separated)" Foreground="{StaticResource TextSecondaryBrush}" Padding="0,0,0,2"/>
            <TextBox x:Name="AllowedProcessesBox" Margin="0,0,0,4" 
                     ToolTip="Only automate these processes. Supports wildcards (e.g., notepad, MyApp*). Leave empty to allow all."/>
            <TextBlock x:Name="AllowlistWarning" Text="âš  No process allowlist set â€” automation can target any window" 
                       Foreground="#FFB74D" FontSize="11" Margin="0,0,0,10" Visibility="Collapsed"/>

            <Separator Margin="0,15"/>

            <TextBlock Text="Agent (AI)" FontSize="14" FontWeight="SemiBold" Foreground="{StaticResource TextBrush}" Margin="0,10,0,10"/>
            
            <Label Content="LLM Endpoint" Foreground="{StaticResource TextSecondaryBrush}" Padding="0,0,0,2"/>
            <TextBox x:Name="AgentEndpointBox" Margin="0,0,0,10" 
                     ToolTip="API endpoint URL (e.g., https://models.inference.ai.azure.com, http://localhost:11434/v1)"/>
            
            <Label Content="Model ID" Foreground="{StaticResource TextSecondaryBrush}" Padding="0,0,0,2"/>
            <TextBox x:Name="AgentModelBox" Margin="0,0,0,10" 
                     ToolTip="Model deployment name or ID (e.g., gpt-4o, gpt-4o-mini)"/>
            
            <Label Content="API Key" Foreground="{StaticResource TextSecondaryBrush}" Padding="0,0,0,2"/>
            <PasswordBox x:Name="AgentApiKeyBox" Margin="0,0,0,10" 
                         Background="{StaticResource CardBrush}" Foreground="{StaticResource TextBrush}"
                         BorderBrush="{StaticResource BorderBrush}" BorderThickness="1" 
                         Padding="8,6"
                         ToolTip="API key for the LLM endpoint"/>
            
            <Grid Margin="0,0,0,10">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>
                <StackPanel Grid.Column="0" Margin="0,0,6,0">
                    <Label Content="Max Tokens" Foreground="{StaticResource TextSecondaryBrush}" Padding="0,0,0,2"/>
                    <TextBox x:Name="AgentMaxTokensBox" ToolTip="Maximum tokens per response (default: 4096)"/>
                </StackPanel>
                <StackPanel Grid.Column="1" Margin="6,0,0,0">
                    <Label Content="Temperature" Foreground="{StaticResource TextSecondaryBrush}" Padding="0,0,0,2"/>
                    <TextBox x:Name="AgentTemperatureBox" ToolTip="0.0 = deterministic, 1.0 = creative (default: 0.3)"/>
                </StackPanel>
            </Grid>

            <TextBlock Text="Vision Fallback" FontSize="13" FontWeight="SemiBold" Foreground="{StaticResource TextBrush}" Margin="0,10,0,6"/>
            <TextBlock Text="Uses LLM vision to locate elements when UIA selectors fail. Requires a vision-capable model (gpt-4o, claude-3.5-sonnet, etc.)." 
                       Foreground="{StaticResource TextSecondaryBrush}" FontSize="11" TextWrapping="Wrap" Margin="0,0,0,8"/>
            
            <CheckBox x:Name="VisionFallbackCheck" Content="Enable vision fallback" Margin="0,0,0,10" 
                      ToolTip="When UIA selectors fail, capture a screenshot and ask the LLM to locate the element visually"/>
            
            <Grid Margin="0,0,0,10">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>
                <StackPanel Grid.Column="0" Margin="0,0,6,0">
                    <Label Content="Vision Model (optional)" Foreground="{StaticResource TextSecondaryBrush}" Padding="0,0,0,2"/>
                    <TextBox x:Name="VisionModelBox" ToolTip="Separate model ID for vision requests. Leave empty to use the main model."/>
                </StackPanel>
                <StackPanel Grid.Column="1" Margin="6,0,0,0">
                    <Label Content="Confidence Threshold" Foreground="{StaticResource TextSecondaryBrush}" Padding="0,0,0,2"/>
                    <TextBox x:Name="VisionConfidenceBox" ToolTip="Minimum confidence (0.0â€“1.0) to accept vision results (default: 0.7)"/>
                </StackPanel>
            </Grid>

            <Separator Margin="0,15"/>

            <StackPanel Orientation="Horizontal" Margin="0,10,0,0">
                <Button Content="ðŸ“‚ Config Folder" Style="{StaticResource ModernButton}" Click="OpenConfigFolder_Click" Margin="0,0,10,0"/>
                <Button Content="ðŸ“‹ Logs Folder" Style="{StaticResource ModernButton}" Click="OpenLogsFolder_Click"/>
            </StackPanel>
            </StackPanel>
        </ScrollViewer>

        <StackPanel Grid.Row="1" Orientation="Horizontal" HorizontalAlignment="Right" Margin="0,20,0,0">
            <Button Content="Save" Style="{StaticResource PrimaryButton}" Click="Save_Click" Width="80" Margin="0,0,10,0"/>
            <Button Content="Cancel" Style="{StaticResource ModernButton}" Click="Cancel_Click" Width="80"/>
        </StackPanel>
    </Grid>
</Window>
