<Window x:Class="IdolClick.UI.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:ctrl="clr-namespace:IdolClick.UI.Controls"
        mc:Ignorable="d"
        Title="Idol Click v1.0.0"
        Height="580" Width="1060"
        MinHeight="420" MinWidth="680"
        Background="{StaticResource BackgroundBrush}"
        WindowStartupLocation="CenterScreen"
        Icon="/Assets/idol-click.png"
        Closing="Window_Closing"
        SizeChanged="Window_SizeChanged"
        StateChanged="Window_StateChanged">

    <Grid>
        <Grid.ColumnDefinitions>
            <!-- Col 0: Activity Bar -->
            <ColumnDefinition Width="48"/>
            <!-- Col 1: Profile Pane (hidden until Classic mode) -->
            <ColumnDefinition x:Name="ProfilePaneColumn" Width="0"/>
            <!-- Col 2: Main Content -->
            <ColumnDefinition Width="*"/>
            <!-- Col 3: Right Panel Splitter -->
            <ColumnDefinition x:Name="RightSplitterCol" Width="0"/>
            <!-- Col 4: Right Panel â€“ Log / Timeline / Plugins -->
            <ColumnDefinition x:Name="RightPanelColumn" Width="0"/>
        </Grid.ColumnDefinitions>
        <Grid.RowDefinitions>
            <!-- Row 0: Status Header -->
            <RowDefinition Height="Auto"/>
            <!-- Row 1: Section Heading (mode breadcrumb) -->
            <RowDefinition Height="Auto"/>
            <!-- Row 2: Main Content -->
            <RowDefinition Height="*"/>
            <!-- Row 3: Footer -->
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- â•â•â• Activity Bar â•â•â• -->
        <Border Grid.Column="0" Grid.RowSpan="4" Background="{StaticResource ActivityBarBrush}">
            <StackPanel VerticalAlignment="Top">
                <Border Height="40" Margin="0,6,0,4">
                    <TextBlock Text="âš™" FontSize="18" Foreground="{StaticResource PrimaryBrush}"
                               HorizontalAlignment="Center" VerticalAlignment="Center"/>
                </Border>

                <RadioButton x:Name="NavClassic" IsChecked="True" Tag="Classic"
                             Style="{StaticResource ActivityBarItem}"
                             Click="NavMode_Click"
                             ToolTip="âš¡ Instinct â€” Rule-based automation">
                    <TextBlock Text="âš¡" FontSize="17"/>
                </RadioButton>
                <RadioButton x:Name="NavAgent" Tag="Agent"
                             Style="{StaticResource ActivityBarItem}"
                             Click="NavMode_Click"
                             ToolTip="ðŸ§  Reason â€” AI Agent mode">
                    <TextBlock Text="ðŸ§ " FontSize="17"/>
                </RadioButton>
                <RadioButton x:Name="NavTeach" Tag="Teach"
                             Style="{StaticResource ActivityBarItem}"
                             Click="NavMode_Click"
                             ToolTip="ðŸŽ“ Teach â€” Smart Sentence Builder">
                    <TextBlock Text="ðŸŽ“" FontSize="17"/>
                </RadioButton>

                <Button Content="âš™" Width="48" Height="36"
                        Style="{StaticResource IconButton}"
                        Click="Settings_Click" Margin="0,6,0,0"
                        ToolTip="Settings"
                        Background="Transparent" BorderThickness="0"
                        Foreground="{StaticResource TextSecondaryBrush}" FontSize="15"/>
            </StackPanel>
        </Border>

        <!-- â•â•â• Profile Pane (Classic-only left sidebar) â•â•â• -->
        <Border x:Name="ProfilePaneBorder" Grid.Column="1" Grid.RowSpan="4" Visibility="Collapsed">
            <ctrl:ProfilePaneControl x:Name="ProfilePane"/>
        </Border>

        <!-- â•â•â• Status Header (spans content + right panel) â•â•â• -->
        <Border Grid.Column="2" Grid.ColumnSpan="3" Grid.Row="0"
                Background="{StaticResource SurfaceBrush}" Padding="14,9"
                BorderThickness="0,0,0,1" BorderBrush="{StaticResource BorderBrush}">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <StackPanel Grid.Column="0" Orientation="Horizontal" VerticalAlignment="Center">
                    <Ellipse x:Name="StatusIndicator" Width="10" Height="10"
                             Fill="{StaticResource ErrorBrush}" Margin="0,0,8,0"/>
                    <TextBlock x:Name="StatusText" Text="Paused"
                               Foreground="{StaticResource TextBrush}" FontSize="{StaticResource FontSizeBody}" FontWeight="SemiBold"/>
                    <TextBlock x:Name="StatsText" Text=" â€¢ 0/0 running"
                               Foreground="{StaticResource TextSecondaryBrush}" FontSize="{StaticResource FontSizeCaption}"
                               Margin="8,0,0,0" VerticalAlignment="Center"/>
                </StackPanel>

                <StackPanel Grid.Column="2" Orientation="Horizontal">
                    <Button x:Name="ProfileToggleBtn" Content="ðŸ“" Width="32" Height="32"
                            Style="{StaticResource IconButton}"
                            Click="ToggleProfilePane_Click"
                            ToolTip="Show/hide profiles"
                            Visibility="Collapsed"/>
                    <ToggleButton x:Name="AutomationToggle"
                                  Content="â–¶" Width="34" Height="32"
                                  ToolTip="Start/Stop automation (Ctrl+Alt+T)"
                                  Click="AutomationToggle_Click"
                                  Style="{StaticResource TogglePlayButton}"
                                  Visibility="Collapsed"/>
                </StackPanel>
            </Grid>
        </Border>

        <!-- â•â•â• Section Heading â€” mode breadcrumb â•â•â• -->
        <Border Grid.Column="2" Grid.ColumnSpan="3" Grid.Row="1"
                Background="{StaticResource CardBrush}"
                BorderThickness="0,0,0,1" BorderBrush="{StaticResource BorderSubtleBrush}">
            <Grid Margin="14,8,14,8">
                <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                    <!-- Accent indicator (color varies per mode) -->
                    <Border x:Name="SectionAccent" Width="3" MinHeight="26" CornerRadius="2"
                            Background="{StaticResource PrimaryBrush}" Margin="0,0,12,0"
                            VerticalAlignment="Stretch"/>
                    <!-- Mode icon -->
                    <TextBlock x:Name="SectionIcon" Text="âš¡" FontSize="16"
                               VerticalAlignment="Center" Margin="0,0,9,0"/>
                    <!-- Title + subtitle -->
                    <StackPanel VerticalAlignment="Center">
                        <TextBlock x:Name="SectionTitle" Text="Instinct"
                                   FontSize="{StaticResource FontSizeBody}" FontWeight="SemiBold"
                                   Foreground="{StaticResource TextBrush}"/>
                        <TextBlock x:Name="SectionSubtitle"
                                   Text="Rule-based automation with profiles and rules"
                                   FontSize="{StaticResource FontSizeSmall}" Foreground="{StaticResource TextSecondaryBrush}"/>
                    </StackPanel>
                </StackPanel>
            </Grid>
        </Border>

        <!-- â•â•â• Rules Panel (Classic â€” Col 2, Row 2) â•â•â• -->
        <Border x:Name="RulesPanelBorder" Grid.Column="2" Grid.Row="2"
                Margin="6,6,4,6" CornerRadius="6">
            <ctrl:RulesPanelControl x:Name="RulesPanel"/>
        </Border>

        <!-- â•â•â• Agent Chat (Agent â€” Col 2, Row 2) â•â•â• -->
        <ctrl:AgentChatControl x:Name="AgentChatPanel"
                               Grid.Column="2" Grid.Row="2"
                               Visibility="Collapsed"/>

        <!-- â•â•â• Teach Panel (Teach â€” Col 2, Row 2) â•â•â• -->
        <Border x:Name="TeachPanelBorder" Grid.Column="2" Grid.Row="2"
                Visibility="Collapsed" Margin="6,6,6,6" CornerRadius="6">
            <ctrl:TeachPanelControl x:Name="TeachPanel"/>
        </Border>

        <!-- â•â•â• Right GridSplitter (Classic mode) â•â•â• -->
        <GridSplitter x:Name="RightSplitter" Grid.Column="3" Grid.Row="2"
                      Width="5" VerticalAlignment="Stretch" HorizontalAlignment="Center"
                      Background="{StaticResource SurfaceBrush}" Visibility="Collapsed"
                      ResizeDirection="Columns"/>

        <!-- â•â•â• Right Panel: Log / Timeline / Plugins (Classic mode) â•â•â• -->
        <Border x:Name="RightPanel" Grid.Column="4" Grid.Row="2"
                Margin="4,6,6,6" Background="{StaticResource SurfaceBrush}"
                CornerRadius="6" Visibility="Collapsed">
            <TabControl x:Name="BottomTabs" Background="Transparent" BorderThickness="0" FontSize="{StaticResource FontSizeSmall}">

                <TabItem Header="ðŸ“‹ Log">
                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="*"/>
                        </Grid.RowDefinitions>

                        <Border Grid.Row="0" Background="{StaticResource CardBrush}" Padding="8,4">
                            <Grid>
                                <StackPanel Orientation="Horizontal">
                                    <ComboBox x:Name="LogLevelCombo" Width="70" FontSize="{StaticResource FontSizeTiny}"
                                              SelectionChanged="LogLevel_Changed">
                                        <ComboBoxItem Content="All" IsSelected="True"/>
                                        <ComboBoxItem Content="Debug"/>
                                        <ComboBoxItem Content="Info"/>
                                        <ComboBoxItem Content="Warning"/>
                                        <ComboBoxItem Content="Error"/>
                                    </ComboBox>
                                </StackPanel>
                                <StackPanel Orientation="Horizontal" HorizontalAlignment="Right">
                                    <Button Content="Clear" Style="{StaticResource SmallButton}"
                                            Click="ClearLog_Click" Margin="0,0,4,0"/>
                                    <Button Content="Open" Style="{StaticResource SmallButton}"
                                            Click="OpenLogFile_Click"/>
                                </StackPanel>
                            </Grid>
                        </Border>

                        <ListBox x:Name="LogListBox" Grid.Row="1" BorderThickness="0"
                                 Background="{StaticResource SurfaceBrush}"
                                 Foreground="{StaticResource TextBrush}"
                                 FontSize="{StaticResource FontSizeMicro}"
                                 SelectionMode="Extended"
                                 ScrollViewer.HorizontalScrollBarVisibility="Auto">
                            <ListBox.ItemContainerStyle>
                                <Style TargetType="ListBoxItem">
                                    <Setter Property="FontSize" Value="{StaticResource FontSizeMicro}"/>
                                    <Setter Property="Padding" Value="3,1"/>
                                    <Setter Property="Margin" Value="0"/>
                                    <Setter Property="MinHeight" Value="0"/>
                                </Style>
                            </ListBox.ItemContainerStyle>
                            <ListBox.ContextMenu>
                                <ContextMenu>
                                    <MenuItem Header="ðŸ“‹ Copy Selected" Click="CopySelectedLog_Click"
                                              InputGestureText="Ctrl+C"/>
                                    <MenuItem Header="ðŸ“‹ Copy All" Click="CopyAllLog_Click"/>
                                    <Separator/>
                                    <MenuItem Header="Select All" Click="SelectAllLog_Click"
                                              InputGestureText="Ctrl+A"/>
                                </ContextMenu>
                            </ListBox.ContextMenu>
                        </ListBox>
                    </Grid>
                </TabItem>

                <TabItem Header="ðŸ“Š Timeline">
                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="*"/>
                        </Grid.RowDefinitions>

                        <Border Grid.Row="0" Background="{StaticResource CardBrush}" Padding="8,4">
                            <Grid>
                                <ComboBox x:Name="TimelineFilterCombo" Width="100" FontSize="{StaticResource FontSizeTiny}"
                                          SelectionChanged="TimelineFilter_Changed">
                                    <ComboBoxItem Content="All" IsSelected="True" Tag=""/>
                                    <ComboBoxItem Content="Matches" Tag="RuleMatch"/>
                                    <ComboBoxItem Content="Actions" Tag="Action"/>
                                </ComboBox>
                                <Button Content="Clear" Style="{StaticResource SmallButton}"
                                        HorizontalAlignment="Right" Click="ClearTimeline_Click"/>
                            </Grid>
                        </Border>

                        <ListView x:Name="TimelineListView" Grid.Row="1" BorderThickness="0"
                                  Background="{StaticResource SurfaceBrush}" FontSize="{StaticResource FontSizeMicro}">
                            <ListView.View>
                                <GridView>
                                    <GridViewColumn Header="" Width="22">
                                        <GridViewColumn.CellTemplate>
                                            <DataTemplate>
                                                <TextBlock Text="{Binding Icon}" FontSize="{StaticResource FontSizeTiny}"/>
                                            </DataTemplate>
                                        </GridViewColumn.CellTemplate>
                                    </GridViewColumn>
                                    <GridViewColumn Header="Time" Width="54">
                                        <GridViewColumn.CellTemplate>
                                            <DataTemplate>
                                                <TextBlock Text="{Binding Timestamp, StringFormat={}{0:HH:mm:ss}}"
                                                           Foreground="{StaticResource TextSecondaryBrush}"/>
                                            </DataTemplate>
                                        </GridViewColumn.CellTemplate>
                                    </GridViewColumn>
                                    <GridViewColumn Header="Rule" Width="70"
                                                    DisplayMemberBinding="{Binding RuleName}"/>
                                    <GridViewColumn Header="Event" Width="160"
                                                    DisplayMemberBinding="{Binding Message}"/>
                                </GridView>
                            </ListView.View>
                        </ListView>
                    </Grid>
                </TabItem>

                <TabItem Header="ðŸ”Œ Plugins">
                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="*"/>
                        </Grid.RowDefinitions>

                        <Border Grid.Row="0" Background="{StaticResource CardBrush}" Padding="8,4">
                            <Grid>
                                <TextBlock Text="Plugins"
                                           Foreground="{StaticResource TextSecondaryBrush}"
                                           FontSize="{StaticResource FontSizeTiny}" VerticalAlignment="Center"/>
                                <StackPanel Orientation="Horizontal" HorizontalAlignment="Right">
                                    <Button Content="â†»" Style="{StaticResource SmallIconButton}"
                                            Click="RefreshPlugins_Click" Margin="0,0,4,0"/>
                                    <Button Content="ðŸ“‚" Style="{StaticResource SmallIconButton}"
                                            Click="OpenPluginsFolder_Click"/>
                                </StackPanel>
                            </Grid>
                        </Border>

                        <ListView x:Name="PluginsListView" Grid.Row="1" BorderThickness="0"
                                  Background="{StaticResource SurfaceBrush}" FontSize="{StaticResource FontSizeTiny}">
                            <ListView.View>
                                <GridView>
                                    <GridViewColumn Header="" Width="28">
                                        <GridViewColumn.CellTemplate>
                                            <DataTemplate>
                                                <CheckBox IsChecked="{Binding Enabled}"
                                                          Checked="PluginEnabled_Changed"
                                                          Unchecked="PluginEnabled_Changed"/>
                                            </DataTemplate>
                                        </GridViewColumn.CellTemplate>
                                    </GridViewColumn>
                                    <GridViewColumn Header="Name" Width="80"
                                                    DisplayMemberBinding="{Binding Name}"/>
                                    <GridViewColumn Header="Type" Width="45"
                                                    DisplayMemberBinding="{Binding Type}"/>
                                    <GridViewColumn Header="Description" Width="120"
                                                    DisplayMemberBinding="{Binding Description}"/>
                                </GridView>
                            </ListView.View>
                        </ListView>
                    </Grid>
                </TabItem>
            </TabControl>
        </Border>

        <!-- â•â•â• Footer (spans content + right panel) â•â•â• -->
        <Border Grid.Column="2" Grid.ColumnSpan="3" Grid.Row="3"
                Background="{StaticResource SurfaceBrush}" Padding="12,8"
                BorderThickness="0,1,0,0" BorderBrush="{StaticResource BorderBrush}">
            <Grid>
                <StackPanel Orientation="Horizontal">
                    <TextBlock x:Name="ProfileIndicator" Text="Default"
                               Foreground="{StaticResource AccentBrush}"
                               FontSize="{StaticResource FontSizeCaption}" FontWeight="SemiBold" VerticalAlignment="Center"
                               ToolTip="Active profile"/>
                    <TextBlock Text="  â€¢  " Foreground="{StaticResource TextSecondaryBrush}"
                               FontSize="{StaticResource FontSizeCaption}" VerticalAlignment="Center"/>
                    <TextBlock x:Name="HotkeyHint" Text="Ctrl+Alt+T"
                               Foreground="{StaticResource TextSecondaryBrush}"
                               FontSize="{StaticResource FontSizeCaption}" VerticalAlignment="Center"/>
                    <TextBlock x:Name="IntervalText" Text="  â€¢  3s"
                               Foreground="{StaticResource TextSecondaryBrush}"
                               FontSize="{StaticResource FontSizeCaption}" VerticalAlignment="Center"/>
                </StackPanel>
                <StackPanel Orientation="Horizontal" HorizontalAlignment="Right">
                    <ComboBox x:Name="IntervalCombo" Width="60" FontSize="{StaticResource FontSizeSmall}"
                              Visibility="Collapsed"
                              ToolTip="Polling interval"
                              SelectionChanged="IntervalCombo_Changed">
                        <ComboBoxItem Content="1s" Tag="1000"/>
                        <ComboBoxItem Content="3s" Tag="3000" IsSelected="True"/>
                        <ComboBoxItem Content="5s" Tag="5000"/>
                        <ComboBoxItem Content="10s" Tag="10000"/>
                    </ComboBox>
                    <TextBlock Text="v1.0.0"
                               Foreground="{StaticResource TextSecondaryBrush}"
                               FontSize="{StaticResource FontSizeSmall}" VerticalAlignment="Center"
                               ToolTip="Idol Click v1.0.0"/>
                </StackPanel>
            </Grid>
        </Border>

    </Grid>
</Window>
