<Window x:Class="IdolClick.UI.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        mc:Ignorable="d"
        Title="Idol Click v1.0.0" 
        Height="700" Width="1000"
        MinHeight="500" MinWidth="700"
        Background="{StaticResource BackgroundBrush}"
        WindowStartupLocation="CenterScreen"
        Icon="/Assets/idol-click.png"
        Closing="Window_Closing">

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="180" MinHeight="120"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*" MinHeight="200"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Header / Status Bar -->
        <Border Grid.Row="0" Background="{StaticResource SurfaceBrush}" Padding="16,12">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <!-- Status -->
                <StackPanel Grid.Column="0" Orientation="Horizontal" VerticalAlignment="Center">
                    <Ellipse x:Name="StatusIndicator" Width="12" Height="12" Fill="{StaticResource ErrorBrush}" Margin="0,0,10,0"/>
                    <TextBlock x:Name="StatusText" Text="Paused" Foreground="{StaticResource TextBrush}" FontSize="16" FontWeight="SemiBold"/>
                    <TextBlock x:Name="StatsText" Text=" | Rules: 0 | Actions: 0" Foreground="{StaticResource TextSecondaryBrush}" FontSize="14" Margin="10,0,0,0" VerticalAlignment="Center"/>
                </StackPanel>

                <!-- Toggle + Settings -->
                <StackPanel Grid.Column="2" Orientation="Horizontal">
                    <CheckBox x:Name="EnabledCheckBox" Content="Automation Enabled" VerticalAlignment="Center" Margin="0,0,20,0" 
                              ToolTip="Toggle automation on/off (Ctrl+Alt+T)" 
                              Checked="EnabledCheckBox_Changed" Unchecked="EnabledCheckBox_Changed"/>
                    
                    <ComboBox x:Name="IntervalCombo" Width="100" Margin="0,0,10,0" ToolTip="Polling interval for UI scanning" SelectionChanged="IntervalCombo_Changed">
                        <ComboBoxItem Content="1 sec" Tag="1000"/>
                        <ComboBoxItem Content="3 sec" Tag="3000" IsSelected="True"/>
                        <ComboBoxItem Content="5 sec" Tag="5000"/>
                        <ComboBoxItem Content="10 sec" Tag="10000"/>
                        <ComboBoxItem Content="30 sec" Tag="30000"/>
                    </ComboBox>
                    
                    <Button Content="âš™  Settings" Style="{StaticResource ModernButton}" Click="Settings_Click" Margin="0,0,10,0" ToolTip="Open application settings"/>
                    <Button Content="âœ•  Exit" Style="{StaticResource DangerButton}" Click="Exit_Click" ToolTip="Exit application"/>
                </StackPanel>
            </Grid>
        </Border>

        <!-- Rules List -->
        <Border Grid.Row="1" Margin="16,12,16,4" Background="{StaticResource SurfaceBrush}" CornerRadius="8">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                </Grid.RowDefinitions>

                <!-- Rules Header -->
                <Border Grid.Row="0" Background="{StaticResource CardBrush}" CornerRadius="8,8,0,0" Padding="10,5">
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>
                        
                        <TextBlock Grid.Column="0" Text="Automation Rules" FontSize="13" FontWeight="SemiBold" Foreground="{StaticResource TextBrush}" VerticalAlignment="Center"/>
                        
                        <!-- Search Box -->
                        <Border Grid.Column="1" Margin="15,0,0,0" Background="{StaticResource SurfaceBrush}" CornerRadius="4" Padding="2">
                            <StackPanel Orientation="Horizontal">
                                <TextBlock Text="ðŸ”" VerticalAlignment="Center" Margin="5,0,5,0" Foreground="{StaticResource TextSecondaryBrush}"/>
                                <TextBox x:Name="SearchTextBox" Width="150" BorderThickness="0" Background="Transparent" 
                                         VerticalAlignment="Center" TextChanged="SearchTextBox_TextChanged"
                                         ToolTip="Search rules (Esc to clear)">
                                    <TextBox.Style>
                                        <Style TargetType="TextBox" BasedOn="{StaticResource {x:Type TextBox}}">
                                            <Setter Property="BorderThickness" Value="0"/>
                                            <Setter Property="Background" Value="Transparent"/>
                                        </Style>
                                    </TextBox.Style>
                                </TextBox>
                            </StackPanel>
                        </Border>
                        
                        <StackPanel Grid.Column="3" Orientation="Horizontal" HorizontalAlignment="Right">
                            <Button Content="ðŸ“¥" Style="{StaticResource ModernButton}" Click="ImportRules_Click" Margin="0,0,4,0" ToolTip="Import rules (Ctrl+O)" Padding="8,5"/>
                            <Button Content="ðŸ“¤" Style="{StaticResource ModernButton}" Click="ExportRules_Click" Margin="0,0,8,0" ToolTip="Export rules (Ctrl+Shift+S)" Padding="8,5"/>
                            <Button Content="ï¼‹ Add" Style="{StaticResource PrimaryButton}" Click="AddRule_Click" Margin="0,0,6,0" ToolTip="Create a new automation rule (Ctrl+N)" Padding="10,5"/>
                            <Button Content="âœŽ Edit" Style="{StaticResource ModernButton}" Click="EditRule_Click" Margin="0,0,6,0" ToolTip="Edit selected rule (Ctrl+E)" Padding="10,5"/>
                            <Button Content="ðŸ—‘ Del" Style="{StaticResource DangerButton}" Click="DeleteRule_Click" Margin="0,0,6,0" ToolTip="Delete selected rule (Del)" Padding="10,5"/>
                            <Button Content="â†»" Style="{StaticResource ModernButton}" Click="ReloadConfig_Click" ToolTip="Reload config.json from disk (F5)" Padding="8,5"/>
                        </StackPanel>
                    </Grid>
                </Border>

                <!-- Rules DataGrid -->
                <ListView x:Name="RulesListView" Grid.Row="1" BorderThickness="0" SelectionMode="Single" MouseDoubleClick="RulesListView_DoubleClick">
                    <ListView.View>
                        <GridView>
                            <GridViewColumn Header="âœ“" Width="40">
                                <GridViewColumn.CellTemplate>
                                    <DataTemplate>
                                        <CheckBox IsChecked="{Binding Enabled}" Checked="RuleEnabled_Changed" Unchecked="RuleEnabled_Changed"/>
                                    </DataTemplate>
                                </GridViewColumn.CellTemplate>
                            </GridViewColumn>
                            <GridViewColumn Header="Name" Width="150" DisplayMemberBinding="{Binding Name}"/>
                            <GridViewColumn Header="Target App" Width="120" DisplayMemberBinding="{Binding TargetApp}"/>
                            <GridViewColumn Header="Match Text" Width="150" DisplayMemberBinding="{Binding MatchText}"/>
                            <GridViewColumn Header="Action" Width="100" DisplayMemberBinding="{Binding Action}"/>
                            <GridViewColumn Header="Cooldown" Width="80" DisplayMemberBinding="{Binding CooldownSeconds, StringFormat={}{0}s}"/>
                            <GridViewColumn Header="Triggers" Width="70" DisplayMemberBinding="{Binding TriggerCount}"/>
                            <GridViewColumn Header="Last Triggered" Width="130">
                                <GridViewColumn.CellTemplate>
                                    <DataTemplate>
                                        <TextBlock Text="{Binding LastTriggered, StringFormat={}{0:HH:mm:ss}, TargetNullValue=Never}"/>
                                    </DataTemplate>
                                </GridViewColumn.CellTemplate>
                            </GridViewColumn>
                        </GridView>
                    </ListView.View>
                </ListView>
            </Grid>
        </Border>

        <!-- Splitter -->
        <GridSplitter Grid.Row="2" Height="5" HorizontalAlignment="Stretch" Background="{StaticResource SurfaceBrush}"/>

        <!-- Log & Timeline Panel -->
        <Border Grid.Row="3" Margin="16,4,16,12" Background="{StaticResource SurfaceBrush}" CornerRadius="8">
            <!-- Version Footer -->
            <Border.ContextMenu>
                <ContextMenu>
                    <MenuItem Header="About Idol Click v1.0.0"/>
                </ContextMenu>
            </Border.ContextMenu>
            <TabControl x:Name="BottomTabs" Background="Transparent" BorderThickness="0">
                
                <!-- Log Tab -->
                <TabItem Header="ðŸ“‹ Log">
                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="*"/>
                        </Grid.RowDefinitions>

                        <!-- Log Header -->
                        <Border Grid.Row="0" Background="{StaticResource CardBrush}" Padding="12,8">
                            <Grid>
                                <StackPanel Orientation="Horizontal">
                                    <ComboBox x:Name="LogLevelCombo" Width="80" SelectionChanged="LogLevel_Changed">
                                        <ComboBoxItem Content="Debug"/>
                                        <ComboBoxItem Content="Info" IsSelected="True"/>
                                        <ComboBoxItem Content="Warning"/>
                                        <ComboBoxItem Content="Error"/>
                                    </ComboBox>
                                </StackPanel>
                                <StackPanel Orientation="Horizontal" HorizontalAlignment="Right">
                                    <Button Content="Clear" Style="{StaticResource ModernButton}" Click="ClearLog_Click" Margin="0,0,8,0"/>
                                    <Button Content="Open Log File" Style="{StaticResource ModernButton}" Click="OpenLogFile_Click"/>
                                </StackPanel>
                            </Grid>
                        </Border>

                        <!-- Log List -->
                        <ListBox x:Name="LogListBox" Grid.Row="1" BorderThickness="0" 
                                 Background="{StaticResource SurfaceBrush}" 
                                 Foreground="{StaticResource TextBrush}"
                                 FontFamily="Consolas" FontSize="11"
                                 ScrollViewer.HorizontalScrollBarVisibility="Auto"/>
                    </Grid>
                </TabItem>
                
                <!-- Timeline Tab -->
                <TabItem Header="ðŸ“Š Timeline">
                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="*"/>
                        </Grid.RowDefinitions>

                        <!-- Timeline Header -->
                        <Border Grid.Row="0" Background="{StaticResource CardBrush}" Padding="12,8">
                            <Grid>
                                <StackPanel Orientation="Horizontal">
                                    <ComboBox x:Name="TimelineFilterCombo" Width="120" SelectionChanged="TimelineFilter_Changed">
                                        <ComboBoxItem Content="All Events" IsSelected="True" Tag=""/>
                                        <ComboBoxItem Content="Rule Matches" Tag="RuleMatch"/>
                                        <ComboBoxItem Content="Actions" Tag="Action"/>
                                        <ComboBoxItem Content="Notifications" Tag="Notification"/>
                                        <ComboBoxItem Content="Scripts" Tag="Script"/>
                                        <ComboBoxItem Content="Plugins" Tag="Plugin"/>
                                    </ComboBox>
                                </StackPanel>
                                <StackPanel Orientation="Horizontal" HorizontalAlignment="Right">
                                    <Button Content="Clear" Style="{StaticResource ModernButton}" Click="ClearTimeline_Click"/>
                                </StackPanel>
                            </Grid>
                        </Border>

                        <!-- Timeline List -->
                        <ListView x:Name="TimelineListView" Grid.Row="1" BorderThickness="0"
                                  Background="{StaticResource SurfaceBrush}">
                            <ListView.View>
                                <GridView>
                                    <GridViewColumn Header="" Width="30">
                                        <GridViewColumn.CellTemplate>
                                            <DataTemplate>
                                                <TextBlock Text="{Binding Icon}" FontSize="14"/>
                                            </DataTemplate>
                                        </GridViewColumn.CellTemplate>
                                    </GridViewColumn>
                                    <GridViewColumn Header="Time" Width="80">
                                        <GridViewColumn.CellTemplate>
                                            <DataTemplate>
                                                <TextBlock Text="{Binding Timestamp, StringFormat={}{0:HH:mm:ss}}" Foreground="{StaticResource TextSecondaryBrush}"/>
                                            </DataTemplate>
                                        </GridViewColumn.CellTemplate>
                                    </GridViewColumn>
                                    <GridViewColumn Header="Rule" Width="120" DisplayMemberBinding="{Binding RuleName}"/>
                                    <GridViewColumn Header="Event" Width="350" DisplayMemberBinding="{Binding Message}"/>
                                </GridView>
                            </ListView.View>
                        </ListView>
                    </Grid>
                </TabItem>
                
                <!-- Plugins Tab -->
                <TabItem Header="ðŸ”Œ Plugins">
                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="*"/>
                        </Grid.RowDefinitions>

                        <!-- Plugins Header -->
                        <Border Grid.Row="0" Background="{StaticResource CardBrush}" Padding="12,8">
                            <Grid>
                                <TextBlock Text="Installed Plugins" Foreground="{StaticResource TextBrush}" VerticalAlignment="Center"/>
                                <StackPanel Orientation="Horizontal" HorizontalAlignment="Right">
                                    <Button Content="âŸ³ Refresh" Style="{StaticResource ModernButton}" Click="RefreshPlugins_Click" Margin="0,0,8,0"/>
                                    <Button Content="ðŸ“‚ Open Folder" Style="{StaticResource ModernButton}" Click="OpenPluginsFolder_Click"/>
                                </StackPanel>
                            </Grid>
                        </Border>

                        <!-- Plugins List -->
                        <ListView x:Name="PluginsListView" Grid.Row="1" BorderThickness="0"
                                  Background="{StaticResource SurfaceBrush}">
                            <ListView.View>
                                <GridView>
                                    <GridViewColumn Header="âœ“" Width="40">
                                        <GridViewColumn.CellTemplate>
                                            <DataTemplate>
                                                <CheckBox IsChecked="{Binding Enabled}" Checked="PluginEnabled_Changed" Unchecked="PluginEnabled_Changed"/>
                                            </DataTemplate>
                                        </GridViewColumn.CellTemplate>
                                    </GridViewColumn>
                                    <GridViewColumn Header="Name" Width="150" DisplayMemberBinding="{Binding Name}"/>
                                    <GridViewColumn Header="ID" Width="120" DisplayMemberBinding="{Binding Id}"/>
                                    <GridViewColumn Header="Type" Width="80" DisplayMemberBinding="{Binding Type}"/>
                                    <GridViewColumn Header="Version" Width="80" DisplayMemberBinding="{Binding Version}"/>
                                    <GridViewColumn Header="Description" Width="250" DisplayMemberBinding="{Binding Description}"/>
                                </GridView>
                            </ListView.View>
                        </ListView>
                    </Grid>
                </TabItem>
            </TabControl>
        </Border>

        <!-- Version Footer -->
        <Border Grid.Row="4" Background="{StaticResource SurfaceBrush}" Padding="16,6">
            <Grid>
                <TextBlock Text="Ctrl+Alt+T to toggle automation" 
                           Foreground="{StaticResource TextSecondaryBrush}" 
                           FontSize="11" 
                           VerticalAlignment="Center"/>
                <TextBlock Text="v1.0.0" 
                           Foreground="{StaticResource TextSecondaryBrush}" 
                           FontSize="11" 
                           HorizontalAlignment="Right" 
                           VerticalAlignment="Center"
                           ToolTip="Idol Click v1.0.0 | github.com/jobijoy/tools"/>
            </Grid>
        </Border>
    </Grid>
</Window>
