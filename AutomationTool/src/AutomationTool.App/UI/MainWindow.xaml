<Window x:Class="AutomationTool.UI.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        mc:Ignorable="d"
        Title="Automation Tool" 
        Height="700" Width="1000"
        MinHeight="500" MinWidth="700"
        Background="{StaticResource BackgroundBrush}"
        WindowStartupLocation="CenterScreen"
        Closing="Window_Closing">

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="200"/>
        </Grid.RowDefinitions>

        <!-- Header / Status Bar -->
        <Border Grid.Row="0" Background="{StaticResource SurfaceBrush}" Padding="16,12">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <!-- Status -->
                <StackPanel Grid.Column="0" Orientation="Horizontal" VerticalAlignment="Center">
                    <Ellipse x:Name="StatusIndicator" Width="12" Height="12" Fill="{StaticResource ErrorBrush}" Margin="0,0,10,0"/>
                    <TextBlock x:Name="StatusText" Text="Paused" Foreground="{StaticResource TextBrush}" FontSize="16" FontWeight="SemiBold"/>
                    <TextBlock x:Name="StatsText" Text=" | Rules: 0 | Actions: 0" Foreground="{StaticResource TextSecondaryBrush}" FontSize="14" Margin="10,0,0,0" VerticalAlignment="Center"/>
                </StackPanel>

                <!-- Toggle + Settings -->
                <StackPanel Grid.Column="2" Orientation="Horizontal">
                    <CheckBox x:Name="EnabledCheckBox" Content="Automation Enabled" VerticalAlignment="Center" Margin="0,0,20,0" Checked="EnabledCheckBox_Changed" Unchecked="EnabledCheckBox_Changed"/>
                    
                    <ComboBox x:Name="IntervalCombo" Width="100" Margin="0,0,10,0" SelectionChanged="IntervalCombo_Changed">
                        <ComboBoxItem Content="1 sec" Tag="1000"/>
                        <ComboBoxItem Content="3 sec" Tag="3000" IsSelected="True"/>
                        <ComboBoxItem Content="5 sec" Tag="5000"/>
                        <ComboBoxItem Content="10 sec" Tag="10000"/>
                        <ComboBoxItem Content="30 sec" Tag="30000"/>
                    </ComboBox>
                    
                    <Button Content="âš™ Settings" Style="{StaticResource ModernButton}" Click="Settings_Click" Margin="0,0,10,0"/>
                    <Button Content="âœ• Exit" Style="{StaticResource DangerButton}" Click="Exit_Click"/>
                </StackPanel>
            </Grid>
        </Border>

        <!-- Rules List -->
        <Border Grid.Row="1" Margin="16,16,16,8" Background="{StaticResource SurfaceBrush}" CornerRadius="8">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                </Grid.RowDefinitions>

                <!-- Rules Header -->
                <Border Grid.Row="0" Background="{StaticResource CardBrush}" CornerRadius="8,8,0,0" Padding="12,8">
                    <Grid>
                        <TextBlock Text="Automation Rules" FontSize="14" FontWeight="SemiBold" Foreground="{StaticResource TextBrush}" VerticalAlignment="Center"/>
                        <StackPanel Orientation="Horizontal" HorizontalAlignment="Right">
                            <Button Content="+ Add Rule" Style="{StaticResource ModernButton}" Click="AddRule_Click" Margin="0,0,8,0"/>
                            <Button Content="âœŽ Edit" Style="{StaticResource ModernButton}" Click="EditRule_Click" Margin="0,0,8,0"/>
                            <Button Content="ðŸ—‘ Delete" Style="{StaticResource DangerButton}" Click="DeleteRule_Click" Margin="0,0,8,0"/>
                            <Button Content="âŸ³ Reload" Style="{StaticResource ModernButton}" Click="ReloadConfig_Click"/>
                        </StackPanel>
                    </Grid>
                </Border>

                <!-- Rules DataGrid -->
                <ListView x:Name="RulesListView" Grid.Row="1" BorderThickness="0" SelectionMode="Single" MouseDoubleClick="RulesListView_DoubleClick">
                    <ListView.View>
                        <GridView>
                            <GridViewColumn Header="âœ“" Width="40">
                                <GridViewColumn.CellTemplate>
                                    <DataTemplate>
                                        <CheckBox IsChecked="{Binding Enabled}" Checked="RuleEnabled_Changed" Unchecked="RuleEnabled_Changed"/>
                                    </DataTemplate>
                                </GridViewColumn.CellTemplate>
                            </GridViewColumn>
                            <GridViewColumn Header="Name" Width="150" DisplayMemberBinding="{Binding Name}"/>
                            <GridViewColumn Header="Target App" Width="120" DisplayMemberBinding="{Binding TargetApp}"/>
                            <GridViewColumn Header="Match Text" Width="150" DisplayMemberBinding="{Binding MatchText}"/>
                            <GridViewColumn Header="Action" Width="100" DisplayMemberBinding="{Binding Action}"/>
                            <GridViewColumn Header="Cooldown" Width="80" DisplayMemberBinding="{Binding CooldownSeconds, StringFormat={}{0}s}"/>
                            <GridViewColumn Header="Triggers" Width="70" DisplayMemberBinding="{Binding TriggerCount}"/>
                            <GridViewColumn Header="Last Triggered" Width="130">
                                <GridViewColumn.CellTemplate>
                                    <DataTemplate>
                                        <TextBlock Text="{Binding LastTriggered, StringFormat={}{0:HH:mm:ss}, TargetNullValue=Never}"/>
                                    </DataTemplate>
                                </GridViewColumn.CellTemplate>
                            </GridViewColumn>
                        </GridView>
                    </ListView.View>
                </ListView>
            </Grid>
        </Border>

        <!-- Splitter -->
        <GridSplitter Grid.Row="2" Height="5" HorizontalAlignment="Stretch" Background="{StaticResource SurfaceBrush}"/>

        <!-- Log Panel -->
        <Border Grid.Row="3" Margin="16,8,16,16" Background="{StaticResource SurfaceBrush}" CornerRadius="8">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                </Grid.RowDefinitions>

                <!-- Log Header -->
                <Border Grid.Row="0" Background="{StaticResource CardBrush}" CornerRadius="8,8,0,0" Padding="12,8">
                    <Grid>
                        <StackPanel Orientation="Horizontal">
                            <TextBlock Text="Log Output" FontSize="14" FontWeight="SemiBold" Foreground="{StaticResource TextBrush}" VerticalAlignment="Center"/>
                            <ComboBox x:Name="LogLevelCombo" Width="80" Margin="20,0,0,0" SelectionChanged="LogLevel_Changed">
                                <ComboBoxItem Content="Debug"/>
                                <ComboBoxItem Content="Info" IsSelected="True"/>
                                <ComboBoxItem Content="Warning"/>
                                <ComboBoxItem Content="Error"/>
                            </ComboBox>
                        </StackPanel>
                        <StackPanel Orientation="Horizontal" HorizontalAlignment="Right">
                            <Button Content="Clear" Style="{StaticResource ModernButton}" Click="ClearLog_Click" Margin="0,0,8,0"/>
                            <Button Content="Open Log File" Style="{StaticResource ModernButton}" Click="OpenLogFile_Click"/>
                        </StackPanel>
                    </Grid>
                </Border>

                <!-- Log List -->
                <ListBox x:Name="LogListBox" Grid.Row="1" BorderThickness="0" 
                         Background="{StaticResource SurfaceBrush}" 
                         Foreground="{StaticResource TextBrush}"
                         FontFamily="Consolas" FontSize="11"
                         ScrollViewer.HorizontalScrollBarVisibility="Auto"/>
            </Grid>
        </Border>
    </Grid>
</Window>
